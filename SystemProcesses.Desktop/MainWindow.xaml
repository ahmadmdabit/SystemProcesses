<Window x:Class="SystemProcesses.Desktop.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:viewmodels="clr-namespace:SystemProcesses.Desktop.ViewModels"
        mc:Ignorable="d"
        Title="System Processes" Height="700" Width="1400"
        WindowStartupLocation="CenterScreen">

    <Window.DataContext>
        <viewmodels:MainViewModel/>
    </Window.DataContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <ToolBar Grid.Row="0" Padding="5">
            <Button Content="End Process"
                    Command="{Binding EndProcessCommand}"
                    Style="{StaticResource ToolbarButtonStyle}"/>
            <Button Content="End Process Tree"
                    Command="{Binding EndProcessTreeCommand}"
                    Style="{StaticResource ToolbarButtonStyle}"/>
            <Separator/>
            <Button Content="Show Details"
                    Command="{Binding ShowProcessDetailsCommand}"
                    Style="{StaticResource ToolbarButtonStyle}"/>
            <Button Content="Open Directory"
                    Command="{Binding OpenProcessDirectoryCommand}"
                    Style="{StaticResource ToolbarButtonStyle}"/>
            <Separator/>
            <ToggleButton Content="Isolate Tree"
                         IsChecked="{Binding IsTreeIsolated}"
                         Style="{StaticResource ToggleButtonStyle}"/>
        </ToolBar>

        <!-- Filter Bar -->
        <Grid Grid.Row="1" Margin="10,5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="100"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="100"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0" Text="Search:" VerticalAlignment="Center" Margin="0,0,5,0"/>
            <TextBox Grid.Column="1"
                     Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                     VerticalAlignment="Center"/>

            <TextBlock Grid.Column="3" Text="Refresh:" VerticalAlignment="Center" Margin="10,0,5,0"/>
            <ComboBox Grid.Column="4"
                      ItemsSource="{Binding RefreshIntervals}"
                      SelectedItem="{Binding SelectedRefreshInterval}"
                      VerticalAlignment="Center"/>

            <Button Grid.Column="6"
                    Content="{Binding PauseResumeText}"
                    Command="{Binding TogglePauseCommand}"
                    MinWidth="80"
                    Margin="5,0,0,0"/>
        </Grid>

        <!-- Process Tree -->
        <TreeView Grid.Row="2"
                  ItemsSource="{Binding Processes}"
                  SelectedItemChanged="TreeView_SelectedItemChanged"
                  BorderThickness="1"
                  BorderBrush="LightGray"
                  Margin="10,0,10,10">

            <TreeView.ItemContainerStyle>
                <Style TargetType="TreeViewItem" BasedOn="{StaticResource TreeViewItemStyle}">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                </Style>
            </TreeView.ItemContainerStyle>

            <TreeView.Resources>
                <HierarchicalDataTemplate DataType="{x:Type viewmodels:ProcessItemViewModel}"
                                          ItemsSource="{Binding Children}">
                    <Grid HorizontalAlignment="Stretch">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="80"/>
                            <ColumnDefinition Width="250"/>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- PID -->
                        <TextBlock Grid.Column="0"
                                   Text="{Binding Pid}"
                                   VerticalAlignment="Center"
                                   Margin="5,2"/>

                        <!-- Name with Icon -->
                        <StackPanel Grid.Column="1"
                                    Orientation="Horizontal"
                                    VerticalAlignment="Center"
                                    Margin="5,2">
                            <Image Source="{Binding Icon}"
                                   Width="16"
                                   Height="16"
                                   Margin="0,0,5,0"
                                   RenderOptions.BitmapScalingMode="HighQuality"/>
                            <TextBlock Text="{Binding Name}"
                                       Foreground="{Binding IsService, Converter={StaticResource ServiceColorConverter}}"
                                       VerticalAlignment="Center"/>
                        </StackPanel>

                        <!-- CPU -->
                        <TextBlock Grid.Column="2"
                                   Text="{Binding CpuPercentage, Converter={StaticResource CpuPercentageConverter}}"
                                   VerticalAlignment="Center"
                                   TextAlignment="Right"
                                   Margin="5,2"/>

                        <!-- Memory -->
                        <TextBlock Grid.Column="3"
                                   Text="{Binding MemoryBytes, Converter={StaticResource BytesToAutoFormatConverter}}"
                                   VerticalAlignment="Center"
                                   TextAlignment="Right"
                                   Margin="5,2"/>

                        <!-- VM Size -->
                        <TextBlock Grid.Column="4"
                                   Text="{Binding VirtualMemoryBytes, Converter={StaticResource BytesToAutoFormatConverter}}"
                                   VerticalAlignment="Center"
                                   TextAlignment="Right"
                                   Margin="5,2"/>

                        <!-- Parameters -->
                        <TextBlock Grid.Column="5"
                                   Text="{Binding Parameters}"
                                   VerticalAlignment="Center"
                                   TextTrimming="CharacterEllipsis"
                                   Margin="5,2"/>
                    </Grid>
                </HierarchicalDataTemplate>
            </TreeView.Resources>
        </TreeView>

        <!-- Status Bar -->
        <StatusBar Grid.Row="3">
            <StatusBarItem>
                <TextBlock Text="{Binding Processes.Count, StringFormat='Total Root Processes: {0}'}"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
